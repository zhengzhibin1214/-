<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>å²³æ¬£å®œ(å®á´—å®)çš„åœ£è¯æ ‘ğŸ„>å²³æ¬£å®œ>yxy
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background: #000; /* é»‘è‰²èƒŒæ™¯æ›´å®¹æ˜“çœ‹åˆ°ç™½è‰²é—®é¢˜ */
        }
        #info { 
            position: absolute; 
            top: 10px; 
            width: 100%; 
            text-align: center; 
            color: #ff69b4; 
            font-family: Arial; 
            z-index: 100;
        }
        #debug {
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: white;
            font-family: monospace;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="info">ç²‰è‰²ç²’å­åœ£è¯æ ‘ | æŒ‰ H é”®åˆ‡æ¢ä¸ºçˆ±å¿ƒ | æŒ‰ R é”®é‡ç½®</div>
    <div id="debug">çŠ¶æ€: åŠ è½½ä¸­...</div>
    
    <!-- ä½¿ç”¨æœ¬åœ°å¤‡ä»½çš„Three.js -->
    <script>
        // å…ˆå°è¯•CDNï¼Œå¤±è´¥åä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ
        function loadThreeJS() {
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js';
            script.onload = initApp;
            script.onerror = function() {
                document.getElementById('debug').innerHTML = 'CDNåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ...';
                // å¤‡ç”¨ï¼šä½¿ç”¨å…¶ä»–CDN
                const fallbackScript = document.createElement('script');
                fallbackScript.src = 'https://unpkg.com/three@0.128.0/build/three.min.js';
                fallbackScript.onload = initApp;
                fallbackScript.onerror = function() {
                    document.getElementById('debug').innerHTML = 'é”™è¯¯: æ— æ³•åŠ è½½Three.jsåº“ï¼è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚';
                };
                document.head.appendChild(fallbackScript);
            };
            document.head.appendChild(script);
        }
        
        function initApp() {
            document.getElementById('debug').innerHTML = 'Three.jsåŠ è½½æˆåŠŸï¼åˆå§‹åŒ–åœºæ™¯...';
            
            try {
                // === 1. åŸºç¡€Three.jsè®¾ç½® ===
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x000000); // æ˜ç¡®è®¾ç½®é»‘è‰²èƒŒæ™¯
                
                const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ antialias: true });
                
                // æ£€æŸ¥WebGLæ”¯æŒ
                if (!renderer.capabilities.isWebGLAvailable) {
                    document.getElementById('debug').innerHTML = 'é”™è¯¯: æµè§ˆå™¨ä¸æ”¯æŒWebGLï¼';
                    return;
                }
                
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);
                
                // === 2. æ·»åŠ ä¸€äº›å…‰çº¿ ===
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xff69b4, 0.8);
                directionalLight.position.set(5, 5, 5);
                scene.add(directionalLight);
                
                // === 3. åˆ›å»ºç²’å­ç³»ç»Ÿ ===
                const particleCount = 800;
                const treeParticles = [];
                const heartParticles = [];
                
                // ç”Ÿæˆåœ£è¯æ ‘ç²’å­
                for (let i = 0; i < particleCount; i++) {
                    const radius = Math.random() * 2;
                    const angle = Math.random() * Math.PI * 2;
                    const height = Math.random() * 4;
                    const effectiveRadius = radius * (1 - height / 4);
                    
                    treeParticles.push(
                        Math.cos(angle) * effectiveRadius,
                        height,
                        Math.sin(angle) * effectiveRadius
                    );
                }
                
                // ç”Ÿæˆçˆ±å¿ƒç²’å­
                for (let i = 0; i < particleCount; i++) {
                    const t = Math.random() * Math.PI * 2;
                    const x = 16 * Math.pow(Math.sin(t), 3);
                    const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
                    
                    heartParticles.push(
                        x * 0.04,
                        y * 0.04 + 2,
                        0
                    );
                }
                
                // ç²’å­æè´¨ - æ˜äº®çš„ç²‰è‰²
                const material = new THREE.PointsMaterial({
                    color: 0xff69b4,
                    size: 0.07,
                    transparent: true,
                    opacity: 0.9,
                    sizeAttenuation: true
                });
                
                // ç²’å­å‡ ä½•ä½“
                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(treeParticles, 3));
                
                const particles = new THREE.Points(geometry, material);
                scene.add(particles);
                
                // === 4. ç›¸æœºä½ç½® ===
                camera.position.z = 8;
                camera.position.y = 2;
                
                // === 5. åŠ¨ç”»å¾ªç¯ ===
                function animate() {
                    requestAnimationFrame(animate);
                    
                    // ç¼“æ…¢æ—‹è½¬
                    particles.rotation.y += 0.005;
                    particles.rotation.x = Math.sin(Date.now() * 0.001) * 0.1;
                    
                    renderer.render(scene, camera);
                }
                animate();
                
                // === 6. å½¢çŠ¶åˆ‡æ¢åŠŸèƒ½ ===
                let isTree = true;
                
                function switchShape() {
                    const positions = geometry.attributes.position.array;
                    const targetShape = isTree ? heartParticles : treeParticles;
                    
                    // åˆ›å»ºå¹³æ»‘è¿‡æ¸¡åŠ¨ç”»
                    const startPositions = [...positions];
                    const startTime = Date.now();
                    const duration = 1000; // 1ç§’è¿‡æ¸¡
                    
                    function transition() {
                        const elapsed = Date.now() - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        
                        // ä½¿ç”¨ç¼“åŠ¨å‡½æ•°ä½¿è¿‡æ¸¡æ›´å¹³æ»‘
                        const easeProgress = progress < 0.5 
                            ? 2 * progress * progress 
                            : 1 - Math.pow(-2 * progress + 2, 2) / 2;
                        
                        for (let i = 0; i < positions.length; i++) {
                            positions[i] = startPositions[i] + (targetShape[i] - startPositions[i]) * easeProgress;
                        }
                        
                        geometry.attributes.position.needsUpdate = true;
                        
                        if (progress < 1) {
                            requestAnimationFrame(transition);
                        } else {
                            isTree = !isTree;
                            document.getElementById('info').textContent = 
                                isTree ? "åœ£è¯æ ‘å½¢çŠ¶ | æŒ‰ H é”®åˆ‡æ¢ä¸ºçˆ±å¿ƒ" : "çˆ±å¿ƒå½¢çŠ¶ | æŒ‰ H é”®åˆ‡æ¢å›åœ£è¯æ ‘";
                        }
                    }
                    
                    transition();
                }
                
                // === 7. äº¤äº’æ§åˆ¶ ===
                window.addEventListener('keydown', (e) => {
                    if (e.code === 'KeyH') {
                        switchShape();
                    }
                    if (e.code === 'KeyR') {
                        // é‡ç½®ä¸ºåœ£è¯æ ‘
                        const positions = geometry.attributes.position.array;
                        for (let i = 0; i < positions.length; i++) {
                            positions[i] = treeParticles[i];
                        }
                        geometry.attributes.position.needsUpdate = true;
                        isTree = true;
                        document.getElementById('info').textContent = "å·²é‡ç½®ä¸ºåœ£è¯æ ‘ | æŒ‰ H é”®åˆ‡æ¢ä¸ºçˆ±å¿ƒ";
                    }
                });
                
                // === 8. å“åº”çª—å£å¤§å°å˜åŒ– ===
                window.addEventListener('resize', () => {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                });
                
                // === 9. æ·»åŠ é¼ æ ‡äº¤äº’ ===
                let mouseX = 0, mouseY = 0;
                window.addEventListener('mousemove', (e) => {
                    mouseX = (e.clientX / window.innerWidth) * 2 - 1;
                    mouseY = -(e.clientY / window.innerHeight) * 2 + 1;
                });
                
                // ä¿®æ”¹åŠ¨ç”»å¾ªç¯åŠ å…¥é¼ æ ‡äº¤äº’
                const originalAnimate = animate;
                animate = function() {
                    requestAnimationFrame(animate);
                    
                    particles.rotation.y += 0.005 + mouseX * 0.01;
                    particles.rotation.x = Math.sin(Date.now() * 0.001) * 0.1 + mouseY * 0.1;
                    
                    renderer.render(scene, camera);
                };
                
                document.getElementById('debug').innerHTML = 
                    `çŠ¶æ€: è¿è¡Œæ­£å¸¸ | ç²’å­æ•°: ${particleCount} | WebGL: ${renderer.capabilities.getMaxAnisotropy()}x`;
                
            } catch (error) {
                document.getElementById('debug').innerHTML = `åˆå§‹åŒ–é”™è¯¯: ${error.message}`;
                console.error(error);
            }
        }
        
        // é¡µé¢åŠ è½½åå¼€å§‹
        window.addEventListener('DOMContentLoaded', loadThreeJS);
    </script>
</body>
</html>
